<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ServGuard | Ger. Máquina</title>
    <link rel="stylesheet" href="../css/main.css">
</head>

<body onload="consultarMaquinas()">
    <!-- ----- TELA PRINCIPAL ----- -->
    <section id="page-gerenciamento-maquina">
        <header>
            <div class="child-navbar-card-dash-adm">
                <div class="navbar-logo-dash-adm">
                    <img src="../assets/img/logo.png" alt="#logo">
                </div>

                <div class="navbar-navlink-dash-adm">
                    <ul class="list-navlink-dash-adm">
                        <li>
                            <a href="./dashboard-adm.html" class="link-dash-adm">
                                <img src="../assets/svg/layout-icon.svg" alt="#icone-layout">
                            </a>
                            <p class="little-text mt-1">Início</p>
                        </li>
                        <li>
                            <a href="./gerenciamento-funcionario.html" class="link-dash-adm">
                                <img src="../assets/svg/func-icon.svg" alt="#icone-func">
                            </a>
                            <p class="little-text mt-1">Funcionário</p>
                        </li>
                        <li>
                            <a href="./gerenciamento-maquina.html" class="link-dash-adm active">
                                <img src="../assets/svg/server-icon-white.svg" alt="#icone-">
                            </a>
                            <p class="little-text mt-1">Máquina</p>
                        </li>
                        <li>
                            <a href="detalhes-funcionario.html" class="link-dash-adm">
                                <img src="../assets/svg/perfil-icon.svg" alt="#icone-">
                            </a>
                            <p class="little-text mt-1">Perfil</p>
                        </li>
                    </ul>
                </div>

                <a href="#" class="navbar-exit-dash-adm" onclick="sairNavbar()">
                    <img src="../assets/svg/exit-icon.svg" alt="">
                </a>
            </div>
        </header>

        <!-- //// FIM NAVBAR //// -->

        <main>

            <div class="father-maquina-card">
                <h3 class="bold">Gerenciamento de máquinas:</h3>
                <div class="child-maquina-card" style="background-color: var(--darked-purple);">
                    <p class="bold text-white italic">Total: <span id="num_total"></span></p>
                </div>
                <div class="child-maquina-card">
                    <p class="bold italic">Ativas: <span id="num_ana"></span></p>
                </div>
                <div class="child-maquina-card">
                    <p class="bold italic">Inativas: <span id="num_adms"></span></p>
                </div>
            </div>


            <div class="father-maquina-lista">
                <div class="child-maquina-colunas">
                    <!-- apenas para alinhar -->
                    <a href="#" class="child-elemento-editar"></a>
                    </a>
                    <div class="child-maquina-elemento-father-colunas">

                        <div class="child-maquina-elemento-coluna-area-id">
                            <p class="bold">ID</p>
                        </div>
                        <div class="child-maquina-elemento-coluna-area-nome">
                            <p class="bold">Nome</p>
                        </div>
                        <div class="child-maquina-elemento-coluna-area-apelido">
                            <p class="bold">Apelido</p>
                        </div>
                        <div class="child-maquina-elemento-coluna-area-cpu">
                            <p class="bold">CPU</p>
                        </div>
                        <div class="child-maquina-elemento-coluna-area-ram">
                            <p class="bold">RAM</p>
                        </div>
                        <div class="child-maquina-elemento-coluna-area-armazenamento">
                            <p class="bold">Armazenamento</p>
                        </div>
                        <div class="child-maquina-elemento-coluna-area-acao"></div>
                    </div>
                </div>
                <div class="child-maquina-father-elemento" id="pai-maquinas">
                    <!-- <div class="child-maquina-elemento">
                        <a href="#" class="child-elemento-editar" onclick="exibirEditar()">
                            <img src="../assets/svg/edit.svg" alt="#icone-">
                        </a>
                        <div class="child-maquina-elemento-infos">
                            
                            <div class="child-maquina-elemento-info-area-id">
                                <p>13</p>
                            </div>
                            <div class="child-maquina-elemento-info-area-nome">
                                <p>Desktop-03</p>
                            </div>
                            <div class="child-maquina-elemento-info-area-apelido">
                                <p>Controle 1</p>
                            </div>
                            <div class="child-maquina-elemento-info-area-cpu">
                                <p>Intell Core i5 12th gen</p>
                            </div>
                            <div class="child-maquina-elemento-info-area-ram">
                                <p>32GB</p>
                            </div>
                            <div class="child-maquina-elemento-info-area-armazenamento">
                                <p>500Gb de 1000Gb</p>
                            </div>
                            <div class="child-maquina-elemento-info-area-acao">
                                <button class="bold underline italic botao-acao"
                                    onclick="DetalhesMaquina()">Detalhes</button>
                            </div>
                        </div>
                    </div> -->
                </div>
            </div>
        </main>
    </section>
    <!-- ----- FIM - TELA PRINCIPAL ----- -->

    <!-- ----- POPUP DE EDITAR MAQUINA ----- -->
    <section class="sessao-popup" id="popupEditar" style="display: none;">
        <div class="father-editar-maquina">
            <h3 class="bold">Altere o campo que quiser e clique em "<span
                    style="color: var(--darked-purple);">atualizar</span>"</h3>
            <div class="child-campos">
                <div class="child-input">
                    <a class="icone-input">
                        <img src="../assets/svg/computer-icon.svg" alt="iconeNome">
                    </a>
                    <input type="text" class="input-popup" placeholder="Apelido da Máquina">
                </div>
                <h5 class="bold">Parâmetros para Disparo de Alertas:</h5>
                <div class="child-input">
                    <a class="icone-input">
                        <img src="../assets/svg/cpu-icon.svg" alt="iconeNome">
                    </a>
                    <input type="text" class="input-popup" placeholder="Uso de CPU(%)">
                </div>
                <div class="child-input">
                    <a class="icone-input">
                        <img src="../assets/svg/ram-icon.svg" alt="iconeNome">
                    </a>
                    <input type="text" class="input-popup" placeholder="Uso de RAM(%)">
                </div>
                <div class="child-input">
                    <a class="icone-input">
                        <img src="../assets/svg/server-icon.svg" alt="iconeNome">
                    </a>
                    <input type="text" class="input-popup" placeholder="Perda de Pacotes">
                </div>
            </div>
            <div class="father-popup-botao">
                <button class="botao-cadastrar-executar" onclick="Atualizar()"><b>Atualizar</b></button>
                <p onclick="sairEditar()" class="botao-cadastrar-cancelar italic underline bold">Sair</p>
            </div>
        </div>
    </section>

</body>
<script>
    function sairNavbar() {
        event.preventDefault();
        sessionStorage.clear();
        window.location.href = "../index.html";
    }

    function DetalhesMaquina() {
        window.location.href = "details-machine.html";
    }

    function exibirEditar() {
        document.getElementById('popupEditar').style.display = 'flex'; // Exibe o popup corretamente
    }
    function sairEditar() {
        document.getElementById('popupEditar').style.display = 'none'; // Exibe o popup corretamente
    }

    function adicionarMaquina(idMaquina, nome, apelido, cpu, ram, armazenamentoUsado, armazenamentoTotal) {

        const elementoPai = document.getElementById("pai-maquinas");

        const novoElemento = `<div class="child-maquina-elemento">
                        <a href="#" class="child-elemento-editar" onclick="exibirEditar()">
                            <img src="../assets/svg/edit.svg" alt="#icone-">
                        </a>
                        <div class="child-maquina-elemento-infos">
                            <!-- minha ideia e dar uma porcentagem para cada elemento exibido  -->
                            <div class="child-maquina-elemento-info-area-id">
                                <p>${idMaquina}</p>
                            </div>
                            <div class="child-maquina-elemento-info-area-nome">
                                <p>${nome}</p>
                            </div>
                            <div class="child-maquina-elemento-info-area-apelido">
                                <p>${apelido}</p>
                            </div>
                            <div class="child-maquina-elemento-info-area-cpu">
                                <p>${cpu}</p>
                            </div>
                            <div class="child-maquina-elemento-info-area-ram">
                                <p>${ram}GB</p>
                            </div>
                            <div class="child-maquina-elemento-info-area-armazenamento">
                                <p>${armazenamentoUsado}GB de ${armazenamentoTotal}GB</p>
                            </div>
                            <div class="child-maquina-elemento-info-area-acao">
                                <button class="bold underline italic botao-acao"
                                    onclick="DetalhesMaquina(${idMaquina})">Detalhes</button>
                            </div>
                        </div>
                    </div>`;

        elementoPai.innerHTML += novoElemento;
    }

    function consultarMaquinas() {

        const idEmpresa = sessionStorage.getItem("ID_EMPRESA_USUARIO");

        fetch(`/maquinas/listarPorEmpresa/${idEmpresa}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            }
        })
            .then(response => response.json())
            .then(data => {
                document.getElementById("num_total").innerText = data.length;

                const maquinasAtivas = data.filter(maquina => maquina.isAtiva === 1);
                document.getElementById("num_ana").innerText = maquinasAtivas.length;

                const maquinasInativas = data.filter(maquina => maquina.isAtiva === 0);
                document.getElementById("num_adms").innerText = maquinasInativas.length;

                data.forEach(maquina => {
                    adicionarMaquina(maquina.idMaquina, maquina.nome, maquina.apelido, maquina.modeloCPU, Math.ceil(maquina.capacidadeRAM), parseInt(maquina.discoUsado), parseInt(maquina.discoTotal));
                });
            });

    }


</script>

</html>