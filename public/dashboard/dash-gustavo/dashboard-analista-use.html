<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ServGuard | Dashboard Detalhes</title>
    <link rel="stylesheet" href="../../css/main.css" />
    <link rel="shortcut icon" href="../../assets/svg/logo-white.svg" type="image/x-icon" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>

<body onload="carregarPagina()">
    <section id="page-dashboard-details-use">
        <header>
            <div class="child-navbar-card-dash-adm">
                <div class="navbar-logo-dash-adm">
                    <img src="../../assets/svg/logo.svg" alt="#logo" />
                </div>
                <div class="navbar-navlink-dash-adm">
                    <ul class="list-navlink-dash-adm" id="ul-nav">
                        <li id="li-adm">
                            <a href="../dashboard-adm.html" class="link-dash-adm">
                                <img src="../../assets/svg/layout-icon.svg" alt="#icone-layout" />
                            </a>
                            <p class="little-text">Início</p>
                        </li>
                        <li>
                            <a href="../dashboard-analista.html" class="link-dash-adm">
                                <img src="../../assets/svg/search.svg" alt="#icone-layout" />
                            </a>
                            <p class="little-text">Detalhes</p>
                        </li>
                        <li id="li-funcionario">
                            <a href="../gerenciamento-funcionario.html" class="link-dash-adm">
                                <img src="../../assets/svg/func-icon.svg" alt="#icone-funcionario" />
                            </a>
                            <p class="little-text">Funcionário</p>
                        </li>
                        <li>
                            <a href="../gerenciamento-maquina.html" class="link-dash-adm">
                                <img src="../../assets/svg/server-icon.svg" alt="#icone-" />
                            </a>
                            <p class="little-text">Máquina</p>
                        </li>
                        <li>
                            <a href="../chat-sgi.html" class="link-dash-adm">
                                <img src="../../assets/svg/logo-sgi.svg" alt="#icone-" />
                            </a>
                            <p class="little-text">SGI</p>
                        </li>
                        <li>
                            <a href="detalhes-funcionario.html" class="link-dash-adm">
                                <img src="../../assets/svg/perfil-icon.svg" alt="#icone-" />
                            </a>
                            <p class="little-text">Perfil</p>
                        </li>
                    </ul>
                </div>
                <a href="#" class="navbar-exit-dash-adm" onclick="sairNavbar()">
                    <img src="../../assets/svg/exit-icon.svg" alt="" />
                </a>
            </div>
        </header>
        <main>
            <div class="dash-alert-topo-use">
                <div class="link-back-seta">
                    <a class="bold text-gray-dark" onclick="voltar()">
                        <div class="icon-trian"></div> Voltar
                    </a>
                </div>
                <h1 class="bold" style="margin-right: 15%;">Máquina <span class="text-purple bold" id="hostname"></span>
                    - ID: <span class="text-purple bold" id="id_maquina">...</span></h1>
            </div>

            <div class="father-dash-alert-use">

                <div class="dash-alert-coluna-1-use">
                    <div class="dash-alert-titulo-detalhe">
                        <h4 class="bold">Detalhes de Alerta:</h4>
                    </div>
                    <div class="father-dash-lista-alertas">
                        <div class="dash-use-total-medições">
                            <div class="dash-adm-parameter-stability-use">
                                <div class="father-tips">
                                    <div class="tooltip tooltip-white">
                                        <h4>i</h4>
                                        <span class="tooltiptext tooltip-left text-black" style="text-align: left">
                                            <span class="bold">Total de Medições:</span><span> Esse campo mostra o total
                                                de capturas realizadas pela máquina selecionada.
                                            </span> <br />
                                            <span class="bold">Total de Alertas CPU:</span><span> Nesse campo temos a
                                                porcentagem apenas dos alertas de CPU em relação ao total de medições.
                                                Onde de 0% a 50% o número ficará <span
                                                    class="text-green bold">verde</span>,
                                                de 50% a 80% o número ficará <span
                                                    class="text-orange bold">laranja</span> e,
                                                de 80% a 100% ficará <span class="text-red bold">vermelho</span>
                                            </span> <br />
                                            <span class="bold">Total de Alertas RAM:</span><span> Nesse campo temos a
                                                porcentagem apenas dos alertas de RAM em relação ao total de
                                                medições. Assim como o "Total de Alertas de CPU", a cor dos números
                                                irá mudar de acordo com o porcentagem.
                                            </span> <br />
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <h4 class="bold" style="margin-top: 2%;">Total de Medições</h4>
                            <!-- <p class="bold" style="margin: 2%; font-size: 45px;">14</p> -->
                            <span class="bold" style="margin: 2%; font-size: 45px;" id="total_medicoes">...</span>
                        </div>
                        <div class="dash-alert-total">
                            <div class="dash-alert-lista-coluna-cpu">
                                <h4 class="bold">Total de alertas de CPU(%)</h4>
                                <p class="bold" style="margin: 2%; font-size: 40px;" id="total_alerta_CPU">...</p>

                            </div>
                            <div class="dash-alert-lista-coluna-ram">
                                <h4 class="bold">Total de alertas de RAM(%)</h4>
                                <p class="bold" style="margin: 2%; font-size: 40px;" id="total_alerta_RAM">...</p>
                            </div>
                        </div>
                        <div class="dash-alert-grafic-box-pai">
                            <div class="dash-alert-grafic-box1">
                                <div class="father-tips">
                                    <div class="tooltip tooltip-white">
                                        <h4>i</h4>
                                        <span class="tooltiptext tooltip-left text-black" style="text-align: left">
                                            <span> Nesse campo temos a
                                                porcentagem da média dos últimos 7 dias do uso da CPU por meio de um
                                                gráfico de Gauge. Assim como os alertas de RAM e CPU, média de uso terá
                                                uma troca de cor para os números de acordo com a porcentagem. 0% até 40%
                                                o número ficará com a cor <span class="text-green bold">verde</span>, de
                                                40% até 60% ficará com a cor <span
                                                    class="text-orange bold">laranja</span>
                                                e, por fim, se passar de 60% ficará <span
                                                    class="text-red bold">vermelho</span>.
                                            </span> <br />
                                        </span>
                                    </div>
                                </div>
                                <div class="dash-titulo-gauge1">
                                    <h4 class="bold">Média de uso CPU</h4>
                                </div>
                                <div id="gaugeChart" style="max-width: 300px; margin: auto;"></div>
                            </div>
                            <div class="dash-alert-grafic-box2">
                                <div class="dash-titulo-gauge2">
                                    <h4 class="bold">Média de uso RAM</h4>
                                </div>
                                <div id="gaugeChart2" style="max-width: 300px; margin: auto;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- BARRA DE DISTRIBUICAO -->
                    <!-- <h4 class="italic bold">Distribuição de alertas por recurso</h4>
                    <div class="dash-alert-campo-barra">

                    </div> -->

                </div>
                <div class="father-dash-alert-use-2">
                    <div class="dash-alert-coluna-2-use">
                        <!-- <div class="father-tips">
                            <div class="tooltip tooltip-white">
                                <h4>i</h4>
                                <span class="tooltiptext tooltip-left text-black" style="text-align: left">
                                    <span> Nesse campo temos a
                                        porcentagem da média dos últimos 7 dias do uso da CPU por meio de um
                                        gráfico de Gauge. Assim como os alertas de RAM e CPU, média de uso terá
                                        uma troca de cor para os números de acordo com a porcentagem. 0% até 40%
                                        o número ficará com a cor <span class="text-green bold">verde</span>, de
                                        40% até 60% ficará com a cor <span
                                            class="text-orange bold">laranja</span>
                                        e, por fim, se passar de 60% ficará <span
                                            class="text-red bold">vermelho</span>.
                                    </span> <br />
                                </span>
                            </div>
                        </div> -->
                        <div class="dash-alert-titulo-detalhe-2">
                            <h4 class="bold">Histórico de Utilização dos últimos 7 dias:</h4>
                        </div>
                        <div class="dash-alert-coluna-2-heat">
                            <div class="dash-use-mapa-heat" id="chart"
                                style="width: 100%; height: 100%; margin: 0 auto; position: relative;"></div>
                        </div>
                        <div class="dash-alert-titulo-detalhe-componente">
                            <h4 class="bold">Histórico de Utilização de Componente:</h4>
                            <!-- <div class="father-tips">
                                <div class="tooltip tooltip-white">
                                    <h4>i</h4>
                                    <span class="tooltiptext tooltip-left text-black" style="text-align: left">
                                        <span> Nesse campo temos a
                                            porcentagem da média dos últimos 7 dias do uso da CPU por meio de um
                                            gráfico de Gauge. Assim como os alertas de RAM e CPU, média de uso terá
                                            uma troca de cor para os números de acordo com a porcentagem. 0% até 40%
                                            o número ficará com a cor <span class="text-green bold">verde</span>, de
                                            40% até 60% ficará com a cor <span
                                                class="text-orange bold">laranja</span>
                                            e, por fim, se passar de 60% ficará <span
                                                class="text-red bold">vermelho</span>.
                                        </span> <br />
                                    </span>
                                </div>
                            </div> -->
                        </div>
                        <div class="dash-alert-coluna-2-grafic">
                            <div class="area-grafic" id="chartBarras"
                                style="width: 100%; height: 100%; margin: 0 auto; position: relative"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </section>
</body>
<script>

    function verificarCargo() {
        var isADM = sessionStorage.getItem("IS_ADM_USUARIO");
        if (isADM !== null && Number(isADM) === 0) {
            document.getElementById('li-adm').style.display = 'none';
            document.getElementById('li-funcionario').style.display = 'none';
            document.getElementById('ul-nav').style.display = 'flex';
        } else {
            document.getElementById('li-adm').style.display = 'flex';
            document.getElementById('li-funcionario').style.display = 'flex';
            document.getElementById('ul-nav').style.display = 'flex';
        }
    }

    const idMaquina = sessionStorage.getItem("ID_MAQUINA");

    idMaquina === null ? Swal.fire({
        icon: "error",
        title: `Falha ao obter o id da máquina!`,
        showConfirmButton: false,
        timer: 1100,
        backdrop: false,
        background: '#EEE9FA'
    }).then(() => {
        window.location.href = "./gerenciamento-maquina.html";
    }) : null;

    function sairNavbar() {
        event.preventDefault();
        sessionStorage.clear();
        window.location.href = "../../index.html";
    }
    function voltar() {
        window.location.href = "../details-machine.html";
    }

    function carregarPagina() {
        consultarMaquina();
        verificarCargo();
        // consultarMaquinasFuncionamento();
        // obterIrrCPU();
        // obterIrrRAM();
        // obterEscalaInstabilidade();
        obterNumeroMedicoes();
        obterPorcentagemCpu();
        obterPorcentagemRam();
        obterMediaGaugeCPU();
        obterMediaGaugeRAM();
        obterUsoTotalSemanal();
        obterUsoTotalSemanalBarras();
    }

    function consultarMaquina() {

        fetch(`/maquinas/listarPorId/${idMaquina}`, {
            dataType: 'json',
            contentType: 'application/json',
        })
            .then(response => response.json())
            .then(data => {

                console.log(data[0]);

                document.getElementById("id_maquina").innerHTML = data[0].idMaquina;
                document.getElementById("hostname").innerHTML = data[0].nome;
                document.getElementById("cpu").innerHTML = data[0].modeloCPU;
                document.getElementById("ram").innerHTML = Math.ceil(data[0].capacidadeRAM);
                document.getElementById("apelido").innerHTML = data[0].apelido;
                document.getElementById("nucleos").innerHTML = data[0].qtdNucleosLogicos;
                document.getElementById("usado").innerHTML = parseFloat(data[0].discoUsado).toFixed(2);
                document.getElementById("total").innerHTML = parseFloat(data[0].discoTotal).toFixed(2);

                if (data[0].isAtiva === 1) {
                    document.getElementById("ativar_maquina").style.display = "none";
                    document.getElementById("desativar_maquina").style.display = "block";
                } else {
                    document.getElementById("ativar_maquina").style.display = "block";
                    document.getElementById("desativar_maquina").style.display = "none";
                }

            })
            .catch(error => console.error(error));
    }

    // function consultarMaquinasFuncionamento() {
    //     const idEmpresa = sessionStorage.getItem("ID_EMPRESA_USUARIO");

    //     fetch(`/maquinas/listarPorEmpresa/${idEmpresa}`, {
    //         method: "GET",
    //         headers: {
    //             "Content-Type": "application/json",
    //         },
    //     })
    //         .then((response) => response.json())
    //         .then((data) => {
    //             document.getElementById("total_maquinas").innerText = data.length;

    //             const maquinasAtivas = data.filter(
    //                 (maquina) => maquina.isAtiva === 1
    //             );
    //             document.getElementById("funcionamento_maquinas").innerText = maquinasAtivas.length;
    //         });
    // }


    function obterNumeroMedicoes() {
        const idEmpresa = sessionStorage.getItem("ID_EMPRESA_USUARIO");

        fetch(`/medidas/totalMedicoes/${idEmpresa}/${idMaquina}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then(function (resposta) {
                console.log("Iniciando a busca do total de medições");

                if (resposta.ok) {
                    return resposta.json().then((json) => {
                        console.log(json);
                        const totalMedicoes = json[0].totalMedicoes;
                        console.log("Número total de capturas:", totalMedicoes);

                        // Atualizando o elemento na página
                        const elementoMedicoes = document.getElementById("total_medicoes");
                        elementoMedicoes.innerHTML = totalMedicoes;
                    });
                } else {
                    console.log("Erro ao tentar capturar o número total de medições!");
                    document.getElementById("total_medicoes").innerHTML = "Erro ao obter";
                    return null; // Retorna null em caso de erro
                }
            })
            .catch(function (erro) {
                console.log("Erro de conexão:", erro);
                return null; // Retorna null em caso de erro de conexão
            });
    }

    function obterPorcentagemCpu() {
        const idEmpresa = sessionStorage.getItem("ID_EMPRESA_USUARIO");
        const idMaquina = sessionStorage.getItem("ID_MAQUINA");

        if (!idMaquina) {
            console.log("ID da máquina não encontrado.");
            return;
        }

        fetch(`/medidas/porcentagemAlertasCPU/${idEmpresa}/${idMaquina}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then(function (resposta) {
                console.log("Iniciando a busca da porcentagem de alertas de CPU");

                if (resposta.ok) {
                    return resposta.json().then((json) => {
                        console.log(json);
                        let porcentagemCPU = json[0].porcentagem_alertas_CPU;
                        console.log("Valor capturado porcentagemCPU:", porcentagemCPU);
                        const elementoCPU = document.getElementById("total_alerta_CPU");
                        // elementoCPU.innerHTML = `${porcentagemFormatada}%`;
                        porcentagemCPU = Number(porcentagemCPU);

                        // Verifica se a conversão foi bem-sucedida
                        if (!isNaN(porcentagemCPU)) {
                            const porcentagemFormatada = porcentagemCPU.toFixed(0); // Agora pode usar toFixed
                            const elementoCPU = document.getElementById("total_alerta_CPU");
                            elementoCPU.innerHTML = `${porcentagemFormatada}%`;
                        } else {
                            console.log("Valor de porcentagemCPU inválido:", porcentagemCPU);
                            document.getElementById("total_alerta_CPU").innerHTML = "Erro ao obter";
                        }

                        // Validação da porcentagem e troca de cor
                        if (porcentagemCPU >= 0 && porcentagemCPU <= 50) {
                            elementoCPU.classList.remove("text-orange", "text-red");
                            elementoCPU.classList.add("text-green");
                        } else if (porcentagemCPU > 50 && porcentagemCPU <= 80) {
                            elementoCPU.classList.remove("text-green", "text-red");
                            elementoCPU.classList.add("text-orange");
                        } else if (porcentagemCPU > 80 && porcentagemCPU <= 100) {
                            elementoCPU.classList.remove("text-green", "text-orange");
                            elementoCPU.classList.add("text-red");
                        } else {
                            // Caso a porcentagem não seja válida (fora do intervalo 0-100)
                            elementoCPU.innerHTML = "Porcentagem inválida";
                            elementoCPU.classList.remove("text-green", "text-orange", "text-red");
                            elementoCPU.classList.add("text-gray");
                        }
                    });
                } else {
                    console.log("Houve um erro ao tentar capturar os dados de porcentagem de CPU!");
                    document.getElementById("total_alerta_CPU").innerHTML = "Erro ao obter";
                    return null; // Retorna null em caso de erro
                }
            })
            .catch(function (erro) {
                console.log(erro);
                return null; // Retorna null em caso de erro de conexão
            });
    }

    function obterPorcentagemRam() {
        const idEmpresa = sessionStorage.getItem("ID_EMPRESA_USUARIO");
        const idMaquina = sessionStorage.getItem("ID_MAQUINA");

        if (!idMaquina) {
            console.log("ID da máquina não encontrado.");
            return;
        }

        fetch(`/medidas/porcentagemAlertasRAM/${idEmpresa}/${idMaquina}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then(function (resposta) {
                console.log("Iniciando a busca da porcentagem de alertas de RAM");

                if (resposta.ok) {
                    return resposta.json().then((json) => {
                        console.log(json);
                        let porcentagemRAM = json[0].porcentagem_alertas_RAM;
                        console.log("Valor capturado porcentagemRAM:", porcentagemRAM);
                        const elementoRAM = document.getElementById("total_alerta_RAM");
                        porcentagemRAM = Number(porcentagemRAM);

                        // Verifica se a conversão foi bem-sucedida
                        if (!isNaN(porcentagemRAM)) {
                            const porcentagemFormatadaRAM = porcentagemRAM.toFixed(0); // Agora pode usar toFixed
                            elementoRAM.innerHTML = `${porcentagemFormatadaRAM}%`;
                        } else {
                            console.log("Valor de porcentagemRAM inválido:", porcentagemRAM);
                            elementoRAM.innerHTML = "Erro ao obter";
                        }

                        // Validação da porcentagem e troca de cor
                        if (porcentagemRAM >= 0 && porcentagemRAM <= 50) {
                            elementoRAM.classList.remove("text-orange", "text-red");
                            elementoRAM.classList.add("text-green");
                        } else if (porcentagemRAM > 50 && porcentagemRAM <= 80) {
                            elementoRAM.classList.remove("text-green", "text-red");
                            elementoRAM.classList.add("text-orange");
                        } else if (porcentagemRAM > 80 && porcentagemRAM <= 100) {
                            elementoRAM.classList.remove("text-green", "text-orange");
                            elementoRAM.classList.add("text-red");
                        } else {
                            // Caso a porcentagem não seja válida (fora do intervalo 0-100)
                            elementoRAM.innerHTML = "Porcentagem inválida";
                            elementoRAM.classList.remove("text-green", "text-orange", "text-red");
                            elementoRAM.classList.add("text-gray");
                        }
                    });
                } else {
                    console.log("Houve um erro ao tentar capturar os dados de porcentagem de RAM!");
                    document.getElementById("total_alerta_RAM").innerHTML = "Erro ao obter";
                    return null; // Retorna null em caso de erro
                }
            })
            .catch(function (erro) {
                console.log(erro);
                return null; // Retorna null em caso de erro de conexão
            });
    }

    function obterMediaGaugeCPU() {
        const idEmpresa = sessionStorage.getItem("ID_EMPRESA_USUARIO");
        const idMaquina = sessionStorage.getItem("ID_MAQUINA");

        fetch(`/medidas/mediaGaugeCPU/${idEmpresa}/${idMaquina}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then((response) => {
                if (!response.ok) {
                    throw new Error("Erro ao obter dados do servidor.");
                }
                return response.json();
            })
            .then((data) => {
                if (data && data.length > 0) {
                    const mediaCPU = data[0].mediaUsoCPU; // Acessa o primeiro item do array e pega a mediaUsoCPU
                    if (mediaCPU === null || mediaCPU === undefined) {
                        console.log("Média de CPU não disponível.");
                        console.log(mediaCPU);
                        console.log(data);
                        return;
                    }

                    // Limpar o conteúdo do elemento do gráfico antes de criar um novo gráfico
                    const element = document.querySelector("#gaugeChart");
                    if (element) {
                        element.innerHTML = ''; // Remove o conteúdo do elemento
                    }

                    // Definir cor com base na média
                    let cor;
                    if (mediaCPU <= 40) {
                        cor = "#32CD32"; // Verde
                    } else if (mediaCPU <= 60) {
                        cor = "#FF9800"; // Laranja
                    } else {
                        cor = "#FF0000"; // Vermelho
                    }

                    // Configuração do gráfico
                    var options = {
                        series: [parseFloat(mediaCPU)], // Valor dinâmico
                        chart: {
                            type: "radialBar",
                            offsetY: -20,
                            sparkline: {
                                enabled: true,
                            },
                        },
                        plotOptions: {
                            radialBar: {
                                startAngle: -90,
                                endAngle: 90,
                                track: {
                                    background: "#e7e7e7",
                                    strokeWidth: "97%",
                                    margin: 5,
                                    dropShadow: {
                                        enabled: true,
                                        top: 2,
                                        left: 0,
                                        color: cor,
                                        opacity: 1,
                                        blur: 2,
                                    },
                                },
                                dataLabels: {
                                    name: {
                                        show: false,
                                    },
                                    value: {
                                        offsetY: -2,
                                        fontSize: "25px",
                                        fontWeight: "bold",
                                        color: "black",
                                        formatter: function (val) {
                                            return val.toFixed(2) + "%"; // Exibe o valor com 2 casas decimais
                                        },
                                    },
                                },
                            },
                        },
                        grid: {
                            padding: {
                                top: -10,
                            },
                        },
                        fill: {
                            type: "solid",
                            colors: [cor], // Aplica a cor dinâmica
                        },
                        // labels: ["Média de CPU:"], // Label do gráfico
                    };

                    // Renderizar o gráfico
                    var chart = new ApexCharts(element, options);
                    chart.render();

                    return chart; // Retorna o objeto do gráfico
                }
            })
            .catch((error) => {
                console.error("Erro ao obter ou processar dados:", error);
            });
    }

    // Garantir que o gráfico seja renderizado após o carregamento da página
    document.addEventListener("DOMContentLoaded", function () {
        obterMediaGaugeCPU();
    });


    function obterMediaGaugeRAM() {
        const idEmpresa = sessionStorage.getItem("ID_EMPRESA_USUARIO");
        const idMaquina = sessionStorage.getItem("ID_MAQUINA");

        fetch(`/medidas/mediaGaugeRAM/${idEmpresa}/${idMaquina}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then((response) => {
                if (!response.ok) {
                    throw new Error("Erro ao obter dados do servidor.");
                }
                return response.json();
            })
            .then((data) => {
                if (data && data.length > 0) {
                    const mediaRAM = data[0].mediaUsoRAM; // Acessa o primeiro item do array e pega a mediaUsoCPU
                    if (mediaRAM === null || mediaRAM === undefined) {
                        console.log("Média de RAM não disponível.");
                        console.log(mediaRAM);
                        console.log(data);
                        return;
                    }

                    // Limpar o conteúdo do elemento do gráfico antes de criar um novo gráfico
                    const element = document.querySelector("#gaugeChart2");
                    if (element) {
                        element.innerHTML = ''; // Remove o conteúdo do elemento
                    }

                    // Definir cor com base na média
                    let cor;
                    if (mediaRAM <= 40) {
                        cor = "#4CAF50"; // Verde
                    } else if (mediaRAM <= 60) {
                        cor = "#FF9800"; // Laranja
                    } else {
                        cor = "#FF0000"; // Vermelho
                    }

                    // Configuração do gráfico
                    var options = {
                        series: [parseFloat(mediaRAM)], // Valor dinâmico
                        chart: {
                            type: "radialBar",
                            offsetY: -20,
                            sparkline: {
                                enabled: true,
                            },
                        },
                        plotOptions: {
                            radialBar: {
                                startAngle: -90,
                                endAngle: 90,
                                track: {
                                    background: "#e7e7e7",
                                    strokeWidth: "97%",
                                    margin: 5,
                                    dropShadow: {
                                        enabled: true,
                                        top: 2,
                                        left: 0,
                                        color: cor,
                                        opacity: 1,
                                        blur: 2,
                                    },
                                },
                                dataLabels: {
                                    name: {
                                        show: false,
                                    },
                                    value: {
                                        offsetY: -2,
                                        fontSize: "25px",
                                        fontWeight: "bold",
                                        color: "black",
                                        formatter: function (val) {
                                            return val.toFixed(2) + "%"; // Exibe o valor com 2 casas decimais
                                        },
                                    },
                                },
                            },
                        },
                        grid: {
                            padding: {
                                top: -10,
                            },
                        },
                        fill: {
                            type: "solid",
                            colors: [cor], // Aplica a cor dinâmica
                        },
                        // labels: ["Média de RAM:"], // Label do gráfico
                    };

                    // Renderizar o gráfico
                    var chart = new ApexCharts(element, options);
                    chart.render();

                    return chart; // Retorna o objeto do gráfico
                }
            })
            .catch((error) => {
                console.error("Erro ao obter ou processar dados:", error);
            });
    }

    // Garantir que o gráfico seja renderizado após o carregamento da página
    document.addEventListener("DOMContentLoaded", function () {
        obterMediaGaugeRAM();
    });

    function obterUsoTotalSemanal() {
        const idEmpresa = sessionStorage.getItem("ID_EMPRESA_USUARIO");
        const idMaquina = sessionStorage.getItem("ID_MAQUINA");

        fetch(`/medidas/usoTotalsemanal/${idEmpresa}/${idMaquina}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then(response => response.json())
            .then(data => {
                // Processar os dados recebidos
                const categories = data.map(item => formatarData(item.data_registro)); // Datas no eixo X
                const usoCPU = data.map(item => item.media_semanal_uso_cpu); // Média de uso CPU
                const usoRAM = data.map(item => item.media_semanal_uso_ram); // Média de uso RAM

                // Configuração do gráfico
                var options = {
                    series: [
                        {
                            name: "Uso Médio RAM (%)",
                            data: usoRAM
                        },
                        {

                            name: "Uso Médio CPU (%)",
                            data: usoCPU
                        }
                    ],
                    chart: {
                        height: 350,
                        type: 'line',
                        dropShadow: {
                            enabled: true,
                            color: '#000',
                            top: 18,
                            left: 7,
                            blur: 10,
                            opacity: 0.2
                        },
                        zoom: {
                            enabled: false
                        },
                        toolbar: {
                            show: false
                        }
                    },
                    colors: ['#4E7AD4', '#8A2BE2'], // Azul para CPU, Vermelho para RAM
                    dataLabels: {
                        enabled: true,
                    },
                    stroke: {
                        curve: 'smooth'
                    },
                    title: {
                        text: 'Uso Semanal da Máquina (CPU e RAM)',
                        align: 'left'
                    },
                    grid: {
                        borderColor: '#e7e7e7',
                        row: {
                            colors: ['#f3f3f3', 'transparent'], // Alternar cores das linhas
                            opacity: 0.5
                        },
                    },
                    markers: {
                        size: 1
                    },
                    xaxis: {
                        categories: categories, // Datas no eixo X
                        title: {
                            text: 'Dos Últimos 7 Dias'
                        }
                    },
                    yaxis: {
                        title: {
                            text: 'Uso Médio (%)'
                        },
                        min: 0,
                        max: 100, // Garantir o range de 0 a 100
                        labels: {
                            formatter: function (value) {
                                return value + "%"; // Adicionar o sufixo "%"
                            }
                        },
                        tickAmount: 5 // Define 5 divisões no eixo Y: 0%, 20%, 40%, 60%, 80%, 100%
                    },
                    legend: {
                        position: 'top',
                        horizontalAlign: 'right',
                        floating: true,
                        offsetY: -25,
                        offsetX: -5
                    }
                };

                // Renderizar o gráfico
                var chart = new ApexCharts(document.querySelector("#chart"), options);
                chart.render();
            })
            .catch(error => { console.error('Erro ao carregar os dados:', error) });

    }


    function obterUsoTotalSemanalBarras() {
        const idEmpresa = sessionStorage.getItem("ID_EMPRESA_USUARIO");
        const idMaquina = sessionStorage.getItem("ID_MAQUINA");

        fetch(`/medidas/usoTotalsemanal/${idEmpresa}/${idMaquina}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then(response => response.json())
            .then(data => {
                // Processar os dados recebidos
                const categories = data.map(item => formatarData(item.data_registro)); // Datas no eixo X
                const usoCPU = data.map(item => item.media_semanal_uso_cpu); // Média de uso CPU
                const usoRAM = data.map(item => item.media_semanal_uso_ram); // Média de uso RAM

                // Configuração do gráfico de barras
                var options = {
                    series: [
                        {
                            name: "Uso Médio CPU (%)",
                            data: usoCPU
                        },
                        {
                            name: "Uso Médio RAM (%)",
                            data: usoRAM
                        }
                    ],
                    chart: {
                        type: 'bar',
                        height: 250
                    },
                    plotOptions: {
                        bar: {
                            horizontal: false,
                            columnWidth: '25%',
                            endingShape: 'rounded'
                        },
                    },
                    dataLabels: {
                        enabled: false
                    },
                    stroke: {
                        show: true,
                        width: 2,
                        colors: ['transparent']
                    },
                    xaxis: {
                        categories: categories, // Datas no eixo X
                        title: {
                            text: 'Dos Últimos 7 Dias'
                        }
                    },
                    yaxis: {
                        title: {
                            text: 'Uso Médio (%)'
                        },
                        min: 0,
                        max: 100, // Garantir o range de 0 a 100
                        labels: {
                            formatter: function (val) {
                                return val + "%"; // Adicionar o sufixo "%"
                            }
                        },
                        tickAmount: 5 // Define 5 divisões no eixo Y: 0%, 20%, 40%, 60%, 80%, 100%
                    },
                    fill: {
                        opacity: 1
                    },
                    tooltip: {
                        y: {
                            formatter: function (val) {
                                return val + "%"; // Adicionar o símbolo de porcentagem no tooltip
                            }
                        }
                    },
                    colors: ['#4E7AD4', '#8A2BE2'], // Azul para CPU, Roxo para RAM
                    legend: {
                        position: 'top',
                        horizontalAlign: 'right',
                        floating: true,
                        offsetY: -25,
                        offsetX: -5
                    }
                };

                // Renderizar o gráfico
                var chart = new ApexCharts(document.querySelector("#chartBarras"), options);
                chart.render();
            })
            .catch(error => {
                console.error('Erro ao carregar os dados:', error);
            });
    }




    // function obterEscalaInstabilidade() {
    //     const idEmpresa = sessionStorage.getItem("ID_EMPRESA_USUARIO");

    //     fetch(`/medidas/escalaInstabilidade/${idEmpresa}`, {
    //         method: "GET",
    //         headers: {
    //             "Content-Type": "application/json",
    //         },
    //     })
    //         .then(function (resposta) {
    //             console.log("Iniciando a busca da escala de instabilidade");

    //             if (resposta.ok) {
    //                 return resposta.json().then((json) => {
    //                     console.log(json);
    //                     const irrPorcentagem = json[0].percentual_irregulares;
    //                     console.log("Valor capturado irrPorcentagem:", irrPorcentagem);

    //                     elementoInstabilidade = document.getElementById(
    //                         "escala-instabilidade-use"
    //                     );
    //                     if (irrPorcentagem < 1) {
    //                         elementoInstabilidade.innerHTML = 0;
    //                     } else if (irrPorcentagem >= 1 && irrPorcentagem < 25) {
    //                         elementoInstabilidade.innerHTML = 1;
    //                     } else if (irrPorcentagem >= 25 && irrPorcentagem < 50) {
    //                         elementoInstabilidade.innerHTML = 2;
    //                     } else if (irrPorcentagem >= 50) {
    //                         elementoInstabilidade.innerHTML = 3;
    //                     }

    //                     valor = parseFloat(elementoInstabilidade.innerText);
    //                     switch (valor) {
    //                         case 0:
    //                             // verde
    //                             elementoInstabilidade.classList.remove(
    //                                 "text-green",
    //                                 "text-red",
    //                                 "text-orange",
    //                                 "text-yellow",
    //                                 "text-gray"
    //                             );
    //                             elementoInstabilidade.classList.add("text-green");
    //                             break;
    //                         case 1:
    //                             // amarelo
    //                             elementoInstabilidade.classList.remove(
    //                                 "text-green",
    //                                 "text-red",
    //                                 "text-orange",
    //                                 "text-yellow",
    //                                 "text-gray"
    //                             );
    //                             elementoInstabilidade.classList.add("text-yellow");
    //                             break;
    //                         case 2:
    //                             // laranja
    //                             elementoInstabilidade.classList.remove(
    //                                 "text-green",
    //                                 "text-red",
    //                                 "text-orange",
    //                                 "text-yellow",
    //                                 "text-gray"
    //                             );
    //                             elementoInstabilidade.classList.add("text-orange");
    //                             break;
    //                         case 3:
    //                             // vermelho
    //                             elementoInstabilidade.classList.remove(
    //                                 "text-green",
    //                                 "text-red",
    //                                 "text-orange",
    //                                 "text-yellow",
    //                                 "text-gray"
    //                             );
    //                             elementoInstabilidade.classList.add("text-red");
    //                             break;
    //                         default:
    //                             // sem cor (teoricamente aqui é impossível)
    //                             elementoInstabilidade.classList.remove(
    //                                 "text-green",
    //                                 "text-red",
    //                                 "text-orange",
    //                                 "text-yellow",
    //                                 "text-gray"
    //                             );
    //                             elementoInstabilidade.classList.add("text-gray");
    //                             break;
    //                     }
    //                 });
    //             } else {
    //                 console.log(
    //                     "Houve um erro ao tentar capturar os dados de irregularidades CPU!"
    //                 );
    //                 document.getElementById("escala-instabilidade-use").innerHTML =
    //                     "Erro ao obter";
    //                 return null; // Retorna null em caso de erro
    //             }
    //         })
    //         .catch(function (erro) {
    //             // console.log(erro);
    //             return null; // Retorna null em caso de erro de conexão
    //         });
    // }

    function formatarData(data) {
        const dataFormatada = new Date(data);
        return dataFormatada.toLocaleDateString();
    }

    // function atualizarMapaInterface(dadosMapa) {

    //     // Criando um array de datas únicas
    //     // Por ser um set, não aceita datas duplicadas
    //     // ... (spread operator) para transformar o set em array de volta
    //     // sort para ordenar as datas em ordem crescente
    //     // map para transformar as datas em objetos
    //     // exemplo do map:
    //     // "2021-09-01" => { name: "01/09/2021", data: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] }
    //     const datas = [...new Set(dadosMapa[0].map(dm => dm.data))].sort();

    //     console.log('DadosMapa', dadosMapa);
    //     console.log('Datas:', datas);

    //     // Criando um array de objetos com as datas e os registros do dia
    //     // para cada data, filtrar os registros do dia
    //     // e transformar em um objeto com a data e os registros
    //     // converte os totais para inteiro (os dados já vem com casas decimais 0,
    //     // mas estou removendo as casas para melhor visualização)
    //     // e retorna o objeto
    //     const series = datas.map(data => {
    //         const registrosDoDia = dadosMapa[0].filter(dm => dm.data === data);
    //         return {
    //             name: formatarData(data),
    //             data: registrosDoDia.map(r => parseInt(r.total_pacotes))
    //         };
    //     });

    //     const options = {
    //         series: series,
    //         chart: {
    //             height: 350,
    //             width: 800,
    //             type: 'heatmap',
    //         },
    //         dataLabels: {
    //             enabled: false
    //         },
    //         colors: ["#6C2BB3"],
    //         title: {
    //             text: 'Mapa de Calor - Uso de CPU e RAM',
    //             offsetY: 15,
    //             offsetX: 250,
    //             style: {
    //                 fontSize: '18px',
    //                 fontWeight: 'bold'
    //             }
    //         },
    //         xaxis: {
    //             categories: Array.from({ length: 24 }, (_, i) =>
    //                 `${String(i).padStart(2, '0')}:00`
    //             ),
    //             // title: {
    //             //     text: 'Horas do Dia'
    //             // }
    //         },
    //         yaxis: {
    //             title: {
    //                 text: 'Dias da Semana'
    //             }
    //         }
    //     };

    //     document.querySelector("#chart").innerHTML = '';
    //     var chart = new ApexCharts(document.querySelector("#chart"), options);
    //     chart.render();
    // }

    // function atualizarMapa(numeroSemana) {
    //     fetch(`/empresas/obterMapaSemana/${sessionStorage.getItem("ID_EMPRESA_USUARIO")}/${numeroSemana}`, {
    //         method: 'GET',
    //         headers: {
    //             'Content-Type': 'application/json',
    //         }
    //     }).then(resposta => resposta.json().then(respostaFormatada => {
    //         console.log('Mapa de calor:', respostaFormatada);
    //         atualizarMapaInterface(respostaFormatada);
    //     })).catch(error => {
    //         console.error('Erro ao obter mapa de calor:', error);
    //     });
    // }

    // function renderGaugeChart(selector, value) {
    //     var options = {
    //         series: [value], // Valor dinâmico
    //         chart: {
    //             type: 'radialBar',
    //             offsetY: -20,
    //             sparkline: {
    //                 enabled: true,
    //             },
    //         },
    //         plotOptions: {
    //             radialBar: {
    //                 startAngle: -90,
    //                 endAngle: 90,
    //                 track: {
    //                     background: "#e7e7e7",
    //                     strokeWidth: "97%",
    //                     margin: 5,
    //                     dropShadow: {
    //                         enabled: true,
    //                         top: 2,
    //                         left: 0,
    //                         color: "#794ED4",
    //                         opacity: 1,
    //                         blur: 2,
    //                     },
    //                 },
    //                 dataLabels: {
    //                     name: {
    //                         show: false,
    //                     },
    //                     value: {
    //                         offsetY: -2,
    //                         fontSize: "22px",
    //                         fontWeight: "bold", // Texto em negrito
    //                         color: "black", // Cor do texto
    //                         formatter: function (val) {
    //                             return val + "%"; // Exibe o valor com "%"
    //                         },
    //                     },
    //                 },
    //             },
    //         },
    //         grid: {
    //             padding: {
    //                 top: -10,
    //             },
    //         },
    //         fill: {
    //             type: "solid", // Preenchimento sólido
    //             colors: ["#794ED4"], // Define a cor roxa
    //         },
    //         labels: ["Média de RAM:"], // Label do gráfico
    //     };

    //     var chart = new ApexCharts(document.querySelector(selector), options);
    //     chart.render();

    //     return chart; // Retorna o objeto do gráfico, caso precise atualizar depois
    // }

    // // Chamada da função para criar o gráfico
    // const chart1 = renderGaugeChart("#chart1", 76);

    // function renderGaugeChart(selector, value) {
    //     var options = {
    //         series: [value], // Valor dinâmico
    //         chart: {
    //             type: 'radialBar',
    //             offsetY: -20,
    //             sparkline: {
    //                 enabled: true
    //             }
    //         },
    //         plotOptions: {
    //             radialBar: {
    //                 startAngle: -90,
    //                 endAngle: 90,
    //                 track: {
    //                     background: "#e7e7e7",
    //                     strokeWidth: '97%',
    //                     margin: 5,
    //                     dropShadow: {
    //                         enabled: true,
    //                         top: 2,
    //                         left: 0,
    //                         color: '#794ED4',
    //                         opacity: 1,
    //                         blur: 2
    //                     }
    //                 },
    //                 dataLabels: {
    //                     name: {
    //                         show: false
    //                     },
    //                     value: {
    //                         offsetY: -2,
    //                         fontSize: '22px',
    //                         fontWeight: 'bold', // Texto em negrito
    //                         color: 'black', // Cor do texto
    //                         formatter: function (val) {
    //                             return val + "%"; // Exibe o valor com "%"
    //                         }
    //                     }
    //                 }
    //             }
    //         },
    //         grid: {
    //             padding: {
    //                 top: -10
    //             }
    //         },
    //         fill: {
    //             type: '',
    //             colors: ['#794ED4'],
    //         },
    //         labels: ['Média de RAM:'], // Label do gráfico
    //     };

    //     var chart = new ApexCharts(document.querySelector(selector), options);
    //     chart.render();

    //     return chart; // Retorna o objeto do gráfico, caso precise atualizar depois
    // }

    // // Chamada da função para criar o gráfico
    // const chart2 = renderGaugeChart("#chart2", 76);



</script>