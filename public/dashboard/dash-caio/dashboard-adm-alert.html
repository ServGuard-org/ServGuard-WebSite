<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ServGuard | Dashboard Alertas</title>
    <link rel="stylesheet" href="../../css/main.css" />
    <link rel="shortcut icon" href="../../assets/svg/logo-white.svg" type="image/x-icon" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="carregarPagina()">
    <section id="page-dashboard-alert">
        <header>
            <div class="child-navbar-card-dash-adm">
                <div class="navbar-logo-dash-adm">
                    <img src="../../assets/svg/logo.svg" alt="#logo" />
                </div>
                <div class="navbar-navlink-dash-adm">
                    <ul class="list-navlink-dash-adm">
                        <li>
                            <a href="../dashboard-adm.html" class="link-dash-adm">
                                <img src="../../assets/svg/layout-icon.svg" alt="#icone-layout" />
                            </a>
                            <p class="little-text mt-1">Início</p>
                        </li>
                        <li>
                            <a href="../dashboard-analista.html" class="link-dash-adm">
                                <img src="../../assets/svg/search.svg" alt="#icone-layout" />
                            </a>
                            <p class="little-text mt-1">Detalhes</p>
                        </li>
                        <li>
                            <a href="../gerenciamento-funcionario.html" class="link-dash-adm">
                                <img src="../../assets/svg/func-icon.svg" alt="#icone-funcionario" />
                            </a>
                            <p class="little-text mt-1">Funcionário</p>
                        </li>
                        <li>
                            <a href="../gerenciamento-maquina.html" class="link-dash-adm">
                                <img src="../../assets/svg/server-icon.svg" alt="#icone-" />
                            </a>
                            <p class="little-text mt-1">Máquina</p>
                        </li>
                        <li>
                            <a href="../detalhes-funcionario.html" class="link-dash-adm">
                                <img src="../../assets/svg/perfil-icon.svg" alt="#icone-" />
                            </a>
                            <p class="little-text mt-1">Perfil</p>
                        </li>
                    </ul>
                </div>
                <a href="#" class="navbar-exit-dash-adm" onclick="sairNavbar()">
                    <img src="../../assets/svg/exit-icon.svg" alt="" />
                </a>
            </div>
        </header>
        <main>
            <div class="dash-alert-topo">
                <h1 class="bold">Monitoramento de alertas:</h1>
                <div class="link-back-seta">
                    <a class="bold text-gray-dark" onclick="voltar()">
                        <div class="icon-trian"></div> Voltar para início
                    </a>
                </div>
            </div>
            <div class="dash-alert-pai">
                <div class="dash-alert-coluna-1">

                    <!-- BARRA DE DISTRIBUICAO -->
                    <h4 class="italic bold">Distribuição de alertas por recurso</h4>
                    <div class="dash-alert-campo-barra text-medium">
                        <div id="graficoRadar" class="campo-acesso-radar bold" onclick="exibirRadar()">
                            <h5 class="underline">
                                Visualização detalhada
                            </h5 class="underline">
                        </div>
                        <div id="cpuArea" class="distribuicao-campo-barra bold"
                            style="width: 0%;">
                            <h6>
                                CPU: ...%
                            </h6>
                        </div>
                        <div id="ramArea" class="distribuicao-campo-barra bold"
                            style="width: 0%;">
                            <h6>
                                RAM: ...%
                            </h6>
                        </div>
                        <div id="usoGeralArea" class="distribuicao-campo-barra bold"
                            style="width: 0%;">
                            <h6>
                                Uso Geral: ...%
                            </h6>
                        </div>
                        <div id="redeArea" class="distribuicao-campo-barra bold" 
                            style="width: 100%;">
                            <h6>
                                REDE: ...%
                            </h6>
                        </div>
                    </div>

                    <!-- LISTA DE ALERTAS -->
                    <div class="dash-alert-lista-pai">
                        <h3 class="italic" style="margin-bottom: 2%;">Ocorrências recentes</h3>
                        <div class="dash-alert-lista-colunas">
                            <div style="width: 13%;">
                                <h4 class="bold">ID</h4>
                            </div>
                            <div style="width: 70%;">
                                <h4 class="bold">Descrição</h4>
                            </div>
                            <div style="width: 10%;"></div>
                        </div>
                        <div class="dash-alert-lista-scroll" id="dash-alert-lista-pai">
                            <!-- OBJETO -->
                            <!-- <div class="dash-alert-lista-objeto">
                                <div style="width: 13%;">
                                    <h4 class=" italic">1</h4>
                                </div>
                                <div style="width: 70%;">
                                    <p class="italic">Descrição</p>
                                </div>
                                <div style="width: 10%;">
                                    <button class="bold underline italic botao-acao"
                                    onclick="DetalhesMaquina()">Detalhes</button>
                                </div>
                            </div>-->
                        </div>
                    </div>
                </div>

                <div class="dash-alert-coluna-2">
                    <div class="dash-alert-coluna-2-dados">
                        <div class="dados-metade">
                            <h5 class="bold italic">Total de ocorrências de hoje:
                                <samp id="id_total_ocorrencias" style="font-size: larger;">...</samp>
                            </h5>
                            <h5 class="bold italic">Média de ocorrências por dia:
                                <samp id="id_media_ocorrencias" style="font-size: larger;">...</samp>
                            </h5>
                        </div>
                        <div class="dados-parte-meio"></div>
                        <div class="dados-metade">
                            <h5 class="bold italic">Total de máquinas:
                                <samp id="id_total_maquinas" style="font-size: larger;">...</samp>
                            </h5>
                            <h5 class="bold italic">Irregulares:
                                <samp id="id_irregularidade_maquinas" style="font-size: larger;"
                                    class="text-black">...</samp>
                            </h5>
                        </div>
                    </div>
                    <div class="dash-alert-coluna-2-area-grafico">
                        <div class="father-tips">
                            <div class="tooltip tooltip-white">
                                <h4>i</h4>
                                <span class="tooltiptext tooltip-left text-black" style="text-align: left">
                                    <span class="bold">Previsão de Tendência</span> <br>
                                    Este gráfico mostra a previsão de tendência de máquinas irregulares nos últimos 30
                                    dias. <br><br>

                                    <span class="bold">Eixo X:</span> Representa as datas dos últimos 30 dias. <br>
                                    <span class="bold">Eixo Y:</span> Indica a frequência de máquinas com
                                    irregularidades registradas em cada dia. <br><br>
                                    A linha de regressão ajuda a identificar a tendência geral, seja de aumento ou
                                    diminuição, no número de máquinas irregulares ao longo do período analisado.
                                </span>
                            </div>
                        </div>
                        <h3 class="" style="font-weight: 500;">Previsão de tendência diária:</h3>
                        <div class="area-grafico">
                            <canvas id="regressionChart" min-width="100%" max-height="100%"></canvas>
                        </div>
                    </div>
                    <div class="pai-popup-radar-fechado" id="areaRadar">
                        <div class="father-tips">
                            <div class="tooltip tooltip-white">
                                <h4>i</h4>
                                <span class="tooltiptext tooltip-left text-black" style="text-align: left">
                                    <span class="bold">Distribuição de Recursos de Alerta</span> <br>
                                    Este gráfico de radar apresenta a distribuição dos alertas por tipo de recurso
                                    monitorado. <br><br>

                                    <span class="bold">Pontas do radar:</span> Representam os recursos monitorados —
                                    CPU, RAM, Uso Geral e Rede. <br>
                                    <span class="bold">Área do radar:</span> Indica a porcentagem de alertas gerados
                                    para cada recurso, permitindo
                                    identificar quais áreas têm maior incidência de problemas. <br><br>
                                    Use este gráfico para entender como os alertas estão distribuídos entre os recursos
                                    e priorizar ações corretivas.
                                </span>
                            </div>
                        </div>
                        <h3 class="bold">Radar de distribuição:</h3>
                        <div class="organizacaopopup">
                            <div class="area-grafico-radar" id="area-grafico-radar">
                                <canvas id="radarChart" style="max-width: 100%; max-height: 100%;"></canvas>
                            </div>
                            <div class="campo-sgi">
                                <h4>Análise da <span class="bold">SGI</span></h4>
                                <div class="campo-sgi-resp">
                                    <p id="respostaSGI">Resposta...</p>
                                </div>
                            </div>
                        </div>
                        <button class="btn-sair-radar bold" onclick="fecharRadar()">Fechar</button>
                    </div>
                </div>
            </div>
        </main>
    </section>
</body>
<script>
    function sairNavbar() {
        event.preventDefault();
        sessionStorage.clear();
        window.location.href = "../../index.html";
    }
    function voltar() {
        window.location.href = "../dashboard-adm.html";
    }
    function carregarPagina() {
        sessionStorage.removeItem("VOLTAR_PAGINA");
        sessionStorage.setItem("VOLTAR_PAGINA", "D_Alert");
        obterDadosDeApoio1()
        obterDadosDeApoio2()
        carregarListaAlertas()
        buscarDistribuicao()
        buscarDadosGrafico()
    }

    function buscarDistribuicao() {

        const idEmpresa = sessionStorage.getItem("ID_EMPRESA_USUARIO");
        var totalM;
        var cpu;
        var ram;
        var rede;
        var outros;
        fetch(`/medidas/distribuicaoAlertas/${idEmpresa}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then(function (resposta) {
                console.log("Iniciando a busca de dados apoio 2");

                if (resposta.ok) {
                    return resposta.json().then((json) => {
                        if (json && json.length > 0) {

                            totalA = json[0].qtdAlertas;
                            cpu = json[0].qtdCpu;
                            cpu = Math.round((cpu * 100) / totalA);
                            ram = json[0].qtdRam;
                            ram = Math.round((ram * 100) / totalA);
                            usoGeral = json[0].qtdUsoGeral;
                            usoGeral = Math.round((usoGeral * 100) / totalA);
                            rede = json[0].qtdRede;
                            rede = Math.round((rede * 100) / totalA);

                            console.log("Total isAlerta:", totalA);
                            console.log("%%%%%%%%%:", cpu, ram, usoGeral, rede);

                            function atualizarDistribuicao(cpuPercent, ramPercent, usoGeralPercent, redePercent) {
                                const densidade = [
                                    { nome: "CPU", porcentagem: cpuPercent },
                                    { nome: "RAM", porcentagem: ramPercent },
                                    { nome: "USO GERAL", porcentagem: usoGeralPercent },
                                    { nome: "REDE", porcentagem: redePercent },
                                ];
                                // tipo order by no js
                                densidade.sort((a, b) => b.porcentagem - a.porcentagem);
                                function validarCorDensidade(idArea, nomePercent) {
                                    // var area = document.getElementById(nomePercent);
                                    var area = idArea
                                    if (densidade[0].nome == nomePercent) {
                                        area.style.backgroundColor = "#36206d"
                                    } else if (densidade[1].nome == nomePercent) {
                                        area.style.backgroundColor = "#4E2E9E"
                                    } else if (densidade[2].nome == nomePercent) {
                                        area.style.backgroundColor = "#6D4BC7"
                                    } else {
                                        area.style.backgroundColor = "#794ED4"
                                    }
                                }

                                const cpuArea = document.getElementById("cpuArea");
                                const ramArea = document.getElementById("ramArea");
                                const usoGeralArea = document.getElementById("usoGeralArea");
                                const redeArea = document.getElementById("redeArea");

                                if (cpuPercent == 0) { cpuArea.style.display = 'none' }
                                cpuArea.style.width = `${cpuPercent}%`;
                                cpuArea.textContent = `CPU: ${cpuPercent}%`;
                                ajustarTamanhoTexto(cpuArea, cpuArea.offsetWidth)
                                validarCorDensidade(cpuArea, "CPU")

                                if (ramPercent == 0) { ramArea.style.display = 'none' }
                                ramArea.style.width = `${ramPercent}%`;
                                ramArea.textContent = `RAM: ${ramPercent}%`;
                                ajustarTamanhoTexto(ramArea, ramArea.offsetWidth)
                                validarCorDensidade(ramArea, "RAM")

                                if (usoGeralPercent == 0) { usoGeralArea.style.display = 'none' }
                                usoGeralArea.style.width = `${usoGeralPercent}%`;
                                usoGeralArea.textContent = `Uso Geral: ${usoGeralPercent}%`;
                                ajustarTamanhoTexto(usoGeralArea, usoGeralArea.offsetWidth)
                                validarCorDensidade(usoGeralArea, "USO GERAL")

                                if (redePercent == 0) { redeArea.style.display = 'none' }
                                redeArea.style.width = `${redePercent}%`;
                                redeArea.textContent = `REDE: ${redePercent}%`;
                                ajustarTamanhoTexto(redeArea, redeArea.offsetWidth)
                                validarCorDensidade(redeArea, "REDE")

                            }
                            function ajustarTamanhoTexto(idArea, width) {
                                if (width <= 5) {
                                    idArea.style.fontSize = "10px";
                                } else if (width <= 10) {
                                    idArea.style.fontSize = "20px";
                                }
                            }
                            atualizarDistribuicao(cpu, ram, usoGeral, rede)
                            gerarGraficoRadar(cpu, ram, usoGeral, rede)

                        } else {
                            console.log("Estrutura JSON inesperada ou vazia.");
                        }
                    });
                } else {
                    console.log(
                        "Houve um erro ao tentar capturar os dados de irregularidades CPU!"
                    );
                    document.getElementById("escala-instabilidade").innerHTML =
                        "Erro ao obter";
                    return null;
                }
            })
            .catch(function (erro) {
                return null;
            });


    }

    function exibirRadar() {
        areaPopup = document.getElementById("areaRadar")
        areaPopup.classList.add("opacidade1");
    }

    function gerarGraficoRadar(cpu, ram, rede, outros) {
        const ctx = document.getElementById("radarChart").getContext('2d');
        // Dados do gráfico
        const data = {
            labels: ['CPU', 'RAM', 'USO GERAL', 'REDE'],
            datasets: [{
                label: 'Porcenagem de Alertas',
                data: [cpu, ram, rede, outros],
                backgroundColor: 'rgba(109, 75, 199, 0.2)',
                borderColor: 'rgba(109, 75, 199, 1)',
                borderWidth: 2
            }]
        };

        // Configurações do gráfico
        const config = {
            type: 'radar',
            data: data,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                },
                scales: {
                    r: {
                        beginAtZero: true
                    }
                }
            }
        };
        new Chart(ctx, config);
    }

    function fecharRadar() {
        areaPopup = document.getElementById("areaRadar")
        areaPopup.classList.remove("opacidade1");
    }

    function carregarListaAlertas() {
        const idEmpresa = sessionStorage.getItem("ID_EMPRESA_USUARIO");
        fetch(`/medidas/listaAlertas/${idEmpresa}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then(function (resposta) {
                console.log("Iniciando a busca dos dados da lista de alertas!");

                if (resposta.ok) {
                    console.log(resposta);

                    resposta.json().then((json) => {
                        console.log(json);
                        console.log(JSON.stringify(json));

                        var listaMaquina = [];
                        var nomeRecurso = [];
                        console.log(`Formando a lista:`);
                        for (var i = 0; i < json.length; i++) {
                            listaMaquina.push(json[i].fkMaquina);
                            nomeRecurso.push(json[i].nome);

                            var textoRecurso;

                            switch (nomeRecurso[i]) {
                                case "usoCPU":
                                    textoRecurso = "Parâmetro de uso de CPU atingido";
                                    break;
                                case "usoRAM":
                                    textoRecurso = "Parâmetro de uso de RAM atingido";
                                    break;
                                case "usoTotal":
                                    textoRecurso = "Capacidade total de uso atingida";
                                    break;
                                case "velocidadeDownload":
                                    textoRecurso = "Limite de velocidade de download atingido";
                                    break;
                                case "velocidadeUpload":
                                    textoRecurso = "Limite de velocidade de upload atingido";
                                    break;
                                case "erroPacotesEntrada":
                                    textoRecurso = "Erro excessivo em pacotes de entrada";
                                    break;
                                case "erroPacotesSaida":
                                    textoRecurso = "Erro excessivo em pacotes de saída";
                                    break;
                                case "descartePacotesEntrada":
                                    textoRecurso = "Descartes excessivos em pacotes de entrada";
                                    break;
                                case "descartePacotesSaida":
                                    textoRecurso = "Descartes excessivos em pacotes de saída";
                                    break;
                                case "megabytesRecebidos":
                                    textoRecurso = "Limite de megabytes recebidos atingido";
                                    break;
                                case "megabytesEnviados":
                                    textoRecurso = "Limite de megabytes enviados atingido";
                                    break;
                                case "pacotesEnviados":
                                    textoRecurso = "Limite de pacotes enviados atingido";
                                    break;
                                case "pacotesRecebidos":
                                    textoRecurso = "Limite de pacotes recebidos atingido";
                                    break;
                                default:
                                    textoRecurso = "Alerta desconhecido";
                            }
                            adicionarLinha(
                                listaMaquina[i],
                                textoRecurso
                            )
                        }
                        console.log(listaMaquina)
                        console.log(nomeRecurso)

                        function adicionarLinha(id, desc) {
                            console.log("Chamou listar alertas!!!")

                            const elementoPai = document.getElementById("dash-alert-lista-pai");

                            const novoElemento = `
                                <div class="dash-alert-lista-objeto">
                                    <div style="width: 13%; padding-left: 1%">
                                        <h4 class="italic">${id}</h4>
                                    </div>
                                    <div style="width: 65%;">
                                        <p class="italic little-text">${desc}</p>
                                    </div>
                                    <div style="width: 27%;">
                                        <button class="bold underline italic botao-acao" onclick="DetalhesMaquina(${id})">Ver Máquina</button>
                                    </div>
                                </div>        
                            `;
                            elementoPai.innerHTML += novoElemento;
                        }
                    });
                } else {
                    console.log(
                        "Houve um erro ao tentar capturar os dados do mapa instabilidade!"
                    );
                }
            })
            .catch(function (erro) {
                console.log(erro);
            });
        return false;
    }

    function DetalhesMaquina(idMaquina) {
        sessionStorage.setItem("ID_MAQUINA", idMaquina);
        window.location.href = "../details-machine.html";
    }

    function obterDadosDeApoio1() {
        const idEmpresa = sessionStorage.getItem("ID_EMPRESA_USUARIO");
        var totalHoje;
        var mediaA;
        fetch(`/medidas/medidasAlertas/${idEmpresa}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then(function (resposta) {
                console.log("Iniciando a busca de dados apoio 2");

                if (resposta.ok) {
                    return resposta.json().then((json) => {
                        if (json && json.length > 0) {
                            totalHoje = json[0].total_capturas_alerta_hoje;
                            mediaA = json[0].media_diaria_alertas;

                            console.log("Valor captura alerta hoje:", totalHoje);
                            console.log("Média alerta diária:", mediaA);

                            const mediaDiaria = document.getElementById("id_media_ocorrencias");
                            const elementoInstabilidade = document.getElementById("id_total_ocorrencias");

                            if (mediaDiaria && elementoInstabilidade) {
                                elementoInstabilidade.innerHTML = totalHoje.toString();
                                mediaDiaria.innerHTML = parseInt(mediaA).toString();

                                const valor = parseFloat(elementoInstabilidade.innerText);
                                const media = parseFloat(mediaDiaria.innerText);

                                console.log("Comparando valor:", valor, "com média:", media);

                                if (valor < media) {
                                    elementoInstabilidade.classList.remove("text-green", "text-red", "text-orange", "text-yellow", "text-gray");
                                    elementoInstabilidade.classList.add("text-green");
                                    console.log("Aplicando classe: text-green");
                                } else if (valor === media) {
                                    elementoInstabilidade.classList.remove("text-green", "text-red", "text-orange", "text-yellow", "text-gray");
                                    elementoInstabilidade.classList.add("text-orange");
                                    console.log("Aplicando classe: text-orange");
                                } else if (valor > media) {
                                    elementoInstabilidade.classList.remove("text-green", "text-red", "text-orange", "text-yellow", "text-gray");
                                    elementoInstabilidade.classList.add("text-red");
                                    console.log("Aplicando classe: text-red");
                                }
                            } else {
                                console.log("Elementos HTML não encontrados para exibição.");
                            }
                        } else {
                            console.log("Estrutura JSON inesperada ou vazia.");
                        }
                    });
                } else {
                    console.log(
                        "Houve um erro ao tentar capturar os dados de irregularidades CPU!"
                    );
                    document.getElementById("escala-instabilidade").innerHTML =
                        "Erro ao obter";
                    return null;
                }
            })
            .catch(function (erro) {
                return null;
            });
    }

    function obterDadosDeApoio2() {
        const idEmpresa = sessionStorage.getItem("ID_EMPRESA_USUARIO");
        var totalM;
        var totalIrr;
        fetch(`/medidas/escalaInstabilidade/${idEmpresa}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then(function (resposta) {
                console.log("Iniciando a busca de dados apoio 1");

                if (resposta.ok) {
                    return resposta.json().then((json) => {
                        console.log(json);
                        totalM = json[0].total_maquinas;
                        totalIrr = json[0].total_maquinas_irregulares;
                        console.log("Total maquinas:", totalM);
                        console.log("Maquinas irregulares:", totalIrr);

                        plotTotalM = document.getElementById("id_total_maquinas");
                        plotTotalIrr = document.getElementById("id_irregularidade_maquinas");
                        porcentagemIrr = (totalIrr * 100) / totalM
                        console.log("PORCENTAGEM IRREGULAREEES", porcentagemIrr)
                        plotTotalM.innerHTML = totalM.toString();
                        plotTotalIrr.innerHTML = totalIrr.toString();
                        if (porcentagemIrr >= 50) {
                            plotTotalIrr.classList.remove(
                                "text-black",
                            );
                            plotTotalIrr.classList.add("text-red");
                        } else if (porcentagemIrr > 1 && porcentagemIrr < 50) {
                            plotTotalIrr.classList.remove(
                                "text-black",
                            );
                            plotTotalIrr.classList.add("text-orange");
                        } else {
                            plotTotalIrr.classList.remove(
                                "text-black",
                            );
                            plotTotalIrr.classList.add("text-green");
                        }
                    });
                } else {
                    console.log(
                        "Houve um erro ao tentar capturar os dados de irregularidades CPU!"
                    );
                    document.getElementById("escala-instabilidade").innerHTML =
                        "Erro ao obter";
                    return null;
                }
            })
            .catch(function (erro) {
                return null;
            });
    }

    function buscarDadosGrafico() {
        const idEmpresa = sessionStorage.getItem("ID_EMPRESA_USUARIO");
        fetch(`/medidas/dadosGraficoAlertas/${idEmpresa}/`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then(function (resposta) {
                console.log("Iniciando a busca dos dados do gráfico alert");

                if (resposta.ok) {
                    console.log(resposta);
                    resposta.json().then((json) => {
                        console.log(json);
                        console.log(JSON.stringify(json));

                        var diasMes = [];
                        var qtdAlertasPDia = [];
                        console.log(`Formando a lista:`);
                        for (var i = 0; i < json.length; i++) {
                            console.log(json[i]);
                            diasMes.push(json[i].dia_mes);
                            qtdAlertasPDia.push(json[i].quantidade_alertas);
                        }

                        function calcularRegressaoLinear(x, y) {
                            const n = x.length;
                            const x_mean = x.reduce((sum, xi) => sum + xi, 0) / n;
                            const y_mean = y.reduce((sum, yi) => sum + yi, 0) / n;

                            let num = 0, den = 0;
                            for (let i = 0; i < n; i++) {
                                num += (x[i] - x_mean) * (y[i] - y_mean);
                                den += (x[i] - x_mean) ** 2;
                            }
                            const slope = num / den;
                            const intercept = y_mean - slope * x_mean;

                            // Calcula valores de y para a linha de tendência
                            const predicted = x.map(xi => slope * xi + intercept);
                            return predicted;
                        }
                        var diaMesCalculo = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30];
                        const linhaDeRegressao = calcularRegressaoLinear(diaMesCalculo, qtdAlertasPDia);
                        console.log("REGRESSÃO LINEAR!!!", linhaDeRegressao)

                        function gerarGrafico() {
                            const ctx = document.getElementById("regressionChart").getContext('2d');
                            new Chart(ctx, {
                                type: 'line',
                                data: {
                                    labels: diasMes,
                                    datasets: [
                                        {
                                            label: 'Máquinas Irregulares',
                                            data: qtdAlertasPDia,
                                            borderColor: '#4E2E9E',
                                            fill: false
                                        },
                                        {
                                            label: 'Tendência (Regressão Linear)',
                                            data: linhaDeRegressao,
                                            borderColor: 'black',
                                            borderDash: [5, 5],
                                            fill: false,
                                            pointRadius: 0
                                        }
                                    ]
                                },
                                options: {
                                    scales: {
                                        x: { title: { display: true, text: 'Data (últimos 30 dias)' } },
                                        y: { title: { display: true, text: 'Frequência de Máquinas Irregulares' } }
                                    },
                                    // responsive: true
                                }
                            });
                        }
                        gerarGrafico();
                    });
                } else {
                    console.log(
                        "Houve um erro ao tentar capturar os dados do gráfico alerta!"
                    );
                }
            })
            .catch(function (erro) {
                console.log(erro);
            });
        return false;
    }

</script>