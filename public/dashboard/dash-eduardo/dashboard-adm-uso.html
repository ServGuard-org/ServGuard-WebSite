<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ServGuard | Dashboard Uso Geral</title>
    <link rel="stylesheet" href="../../css/main.css" />
    <link
      rel="shortcut icon"
      href="../../assets/svg/logo-white.svg"
      type="image/x-icon"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  </head>

  <body onload="carregarPagina()">
    <section id="page-dashboard-usoGeral">
      <header>
        <div class="child-navbar-card-dash-adm">
          <div class="navbar-logo-dash-adm">
            <img src="../../assets/svg/logo.svg" alt="#logo" />
          </div>
          <div class="navbar-navlink-dash-adm">
            <ul class="list-navlink-dash-adm">
              <li>
                <a href="../dashboard-adm.html" class="link-dash-adm">
                  <img
                    src="../../assets/svg/layout-icon.svg"
                    alt="#icone-layout"
                  />
                </a>
                <p class="little-text">Início</p>
              </li>
              <li>
                <a href="../dashboard-analista.html" class="link-dash-adm">
                  <img src="../../assets/svg/search.svg" alt="#icone-layout" />
                </a>
                <p class="little-text">Detalhes</p>
              </li>
              <li>
                <a
                  href="../gerenciamento-funcionario.html"
                  class="link-dash-adm"
                >
                  <img
                    src="../../assets/svg/func-icon.svg"
                    alt="#icone-funcionario"
                  />
                </a>
                <p class="little-text">Funcionário</p>
              </li>
              <li>
                <a href="../gerenciamento-maquina.html" class="link-dash-adm">
                  <img src="../../assets/svg/server-icon.svg" alt="#icone-" />
                </a>
                <p class="little-text">Máquina</p>
              </li>
              <li>
                <a href="../chat-sgi.html" class="link-dash-adm">
                  <img src="../../assets/svg/logo-sgi.svg" alt="#icone-" />
                </a>
                <p class="little-text">SGI</p>
              </li>
              <li>
                <a href="detalhes-funcionario.html" class="link-dash-adm">
                  <img src="../../assets/svg/perfil-icon.svg" alt="#icone-" />
                </a>
                <p class="little-text">Perfil</p>
              </li>
            </ul>
          </div>
          <a href="#" class="navbar-exit-dash-adm" onclick="sairNavbar()">
            <img src="../../assets/svg/exit-icon.svg" alt="" />
          </a>
        </div>
      </header>
      <main>
        <div class="dash-alert-topo">
          <div class="link-back-seta">
            <a class="bold text-gray-dark" onclick="voltar()">
              <div class="icon-trian"></div>
              Voltar para início
            </a>
          </div>
          <div class="dash-alert-titulo">
            <h1 class="bold">Monitoramento de Uso Geral:</h1>
          </div>
        </div>

        <div class="father-general-use">
          <div
            class="child-analise-uso"
            id="card-analise-uso"
            style="display: none"
          >
            <div class="card-analise-uso">
              <h2 class="center bold">Tendencia de Uso Semanal</h2>
              <div class="cards-space-graphic">
                <div class="graphic-space">
                  <div class="card-graphic-analise"></div>
                </div>
                <div class="sgi-space">
                  <div class="card-sgi-analise"></div>
                </div>
              </div>
              <div class="button-space">
                <button class="btn-dashboard" onclick="fecharAnalise()">
                  Fechar
                </button>
              </div>
            </div>
          </div>
          <div class="child-general-use">
            <div class="general-use-content-medium">
              <div class="general-use-father-three">
                <h4 class="bold center">
                  Histograma de Uso de Hardware das Máquinas:
                </h4>
                <canvas
                  id="histograma-uso"
                  class="space-graphic"
                  style="height: 300px"
                ></canvas>
              </div>
            </div>

            <div class="general-use-content-large">
              <div class="gerenal-use-father-one">
                <div class="general-use-cards-info">
                  <div class="card-info">
                    <h5 class="center">
                      Quantidade de Máquinas com Uso de Hardware Maior que 80%
                    </h5>
                    <h1 class="bold center" id="uso-hardware-kpi">...</h1>
                  </div>
                  <div class="card-info">
                    <h5 class="center">
                      Quantidade de Máquinas com Uso de Disco Maior que 80%
                    </h5>
                    <h1 class="bold center" id="uso-disco-kpi">...</h1>
                  </div>
                </div>

                <div class="general-use-card-tendencia">
                  <h3 class="bold center">Tendência de Uso:</h3>
                  <p class="center">
                    Acompanhe aqui as tendências de uso das máquinas,
                    identificando padrões críticos de desempenho e antecipando
                    possíveis sobrecargas.
                  </p>
                  <button class="btn-dashboard" onclick="AnalisedeUso()">
                    Ver Análise de Uso
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="child-general-use">
            <div class="general-use-content-medium">
              <div class="general-use-father-three">
                <h4 class="bold center">
                  Histograma de Uso de Disco das Máquinas:
                </h4>
                <canvas
                  id="histograma-disco"
                  class="space-graphic"
                  style="height: 300px"
                ></canvas>
              </div>
            </div>
            <div class="general-use-content-large">
              <div class="general-use-father-two">
                <div class="list-machine-menu">
                  <h3>Lista de Máquinas:</h3>
                </div>
                <div class="list-machine-card">
                  <div class="column-machine">
                    <div class="column-item">
                      <p class="little-text bold">ID</p>
                    </div>
                    <div class="column-item">
                      <p class="little-text bold">Hostname</p>
                    </div>
                    <div class="column-item">
                      <p class="little-text bold">Uso de Hardware</p>
                    </div>
                    <div class="column-item">
                      <p class="little-text bold">Uso de Disco</p>
                    </div>
                    <div class="column-item">
                      <p class="little-text bold">
                        Problabilidade de Sobrecarga
                      </p>
                    </div>
                  </div>

                  <hr class="line-list-machine" />

                  <div class="machine-card-space">
                    <div class="machine-card">
                      <div class="column-item">
                        <p class="little-text bold">01</p>
                      </div>
                      <div class="column-item">
                        <p class="little-text bold">BOOK-1AMQ3DUG8E</p>
                      </div>
                      <div class="column-item">
                        <p class="little-text bold">80%</p>
                      </div>
                      <div class="column-item">
                        <p class="little-text bold">60%</p>
                      </div>
                      <div class="column-item">
                        <p class="little-text bold">95%</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </section>

    <script>
      function sairNavbar() {
        event.preventDefault();
        sessionStorage.clear();
        window.location.href = "../index.html";
      }

      function voltar() {
        window.location.href = "../dashboard-adm.html";
      }

      function AnalisedeUso() {
        const analiseUse = document.getElementById("card-analise-uso");
        analiseUse.style.display = "flex";
      }

      function fecharAnalise() {
        const analiseUse = document.getElementById("card-analise-uso");
        analiseUse.style.display = "none";
      }

      function carregarPagina() {
        sessionStorage.removeItem("VOLTAR_PAGINA");
        sessionStorage.setItem("VOLTAR_PAGINA", "D_Alert");
        obterDadosHistogramaUso();
        obterDadosHistogramaDisco();
        buscarUsoHardwareAlto();
        buscarUsoDiscoAlto();
      }

      // ------------------------------------- // PARAMETROS DE USO MAIOR QUE 80  // ------------------------------------- //

      function buscarUsoHardwareAlto() {
        const idEmpresa = sessionStorage.getItem("ID_EMPRESA_USUARIO");

        fetch(`/medidas/usohardwarealto/${idEmpresa}`, {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            // Supondo que 'data.usoHardwareAlto' seja o campo com o número que você quer exibir
            document.getElementById("uso-hardware-kpi").innerText = data[0].qtdMaquinas;
          })
          .catch((error) => {
            console.error("Erro ao buscar uso de hardware:", error);
          });
      }

      function buscarUsoDiscoAlto() {
        const idEmpresa = sessionStorage.getItem("ID_EMPRESA_USUARIO");

        fetch(`/medidas/usoDiscoAlto/${idEmpresa}`, {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            // Supondo que 'data.usoHardwareAlto' seja o campo com o número que você quer exibir
            document.getElementById("uso-disco-kpi").innerText = data;
          })
          .catch((error) => {
            console.error("Erro ao buscar uso de disco:", error);
          });
      }

      // ------------------------------------- // HISTOGRAMAS // ------------------------------------- //
      function obterDadosHistogramaUso() {
        const dadosMocados = [
          { faixa: "0-50%", quantidade: 10 },
          { faixa: "50-80%", quantidade: 7 },
          { faixa: "80-100%", quantidade: 3 },
        ];

        const labels = dadosMocados.map((item) => item.faixa);
        const dados = dadosMocados.map((item) => item.quantidade);

        const ctx = document.getElementById("histograma-uso").getContext("2d");
        const grafico = new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Máquinas por Faixa de Uso de Hardware",
                data: dados,
                backgroundColor: ["#36206d", "#4E2E9E", "#9870FF"],
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: "top",
              },
            },
            scales: {
              x: {
                beginAtZero: true,
              },
            },
          },
        });
      }

      function obterDadosHistogramaDisco() {
        const dadosMocados = [
          { faixa: "0-50%", quantidade: 10 },
          { faixa: "50-80%", quantidade: 7 },
          { faixa: "80-100%", quantidade: 3 },
        ];

        const labels = dadosMocados.map((item) => item.faixa);
        const dados = dadosMocados.map((item) => item.quantidade);

        const ctx = document
          .getElementById("histograma-disco")
          .getContext("2d");
        const grafico = new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Máquinas por Faixa de Uso de Disco",
                data: dados,
                backgroundColor: ["#36206d", "#4E2E9E", "#9870FF"],
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: "top",
              },
            },
            scales: {
              x: {
                beginAtZero: true,
              },
            },
          },
        });
      }
    </script>
  </body>
</html>
